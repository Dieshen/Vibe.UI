@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<div class="theme-selector">
    <select class="theme-select" @bind="SelectedThemeId" @bind:event="oninput">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="ocean">Ocean</option>
        <option value="forest">Forest</option>
        <option value="sunset">Sunset</option>
        <option value="purple">Purple</option>
        <option value="midnight">Midnight</option>
    </select>
    <span class="theme-icon">ðŸŽ¨</span>
</div>

@code {
    private string _selectedThemeId = "light";

    private string SelectedThemeId
    {
        get => _selectedThemeId;
        set
        {
            if (_selectedThemeId != value)
            {
                _selectedThemeId = value;
                _ = ApplyThemeAsync(value);
            }
        }
    }

    private async Task ApplyThemeAsync(string themeId)
    {
        if (string.IsNullOrEmpty(themeId)) return;

        var themeVariables = GetThemeVariables(themeId);
        if (themeVariables != null)
        {
            await JSRuntime.InvokeVoidAsync("vibeDocsTheme.applyTheme", themeVariables);
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", "vibe-theme", themeId);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var savedTheme = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "vibe-theme");
            if (!string.IsNullOrEmpty(savedTheme))
            {
                _selectedThemeId = savedTheme;
                StateHasChanged();
            }
            await ApplyThemeAsync(_selectedThemeId);
        }
    }

    private Dictionary<string, string>? GetThemeVariables(string themeId) => themeId switch
    {
        "light" => new Dictionary<string, string>
        {
            ["--vibe-background"] = "#ffffff",
            ["--vibe-foreground"] = "#111111",
            ["--vibe-primary"] = "#0066cc",
            ["--vibe-primary-foreground"] = "#ffffff",
            ["--vibe-secondary"] = "#f4f4f4",
            ["--vibe-secondary-foreground"] = "#333333",
            ["--vibe-accent"] = "#ff4500",
            ["--vibe-border"] = "#e2e2e2",
            ["--vibe-muted-foreground"] = "#666666",
            ["--vibe-card"] = "#ffffff"
        },
        "dark" => new Dictionary<string, string>
        {
            ["--vibe-background"] = "#1a1a1a",
            ["--vibe-foreground"] = "#ffffff",
            ["--vibe-primary"] = "#0099ff",
            ["--vibe-primary-foreground"] = "#ffffff",
            ["--vibe-secondary"] = "#2a2a2a",
            ["--vibe-secondary-foreground"] = "#f7f7f7",
            ["--vibe-accent"] = "#ff4500",
            ["--vibe-border"] = "#404040",
            ["--vibe-muted-foreground"] = "#a0a0a0",
            ["--vibe-card"] = "#222222"
        },
        "ocean" => new Dictionary<string, string>
        {
            ["--vibe-background"] = "#f0f9ff",
            ["--vibe-foreground"] = "#0c4a6e",
            ["--vibe-primary"] = "#0284c7",
            ["--vibe-primary-foreground"] = "#ffffff",
            ["--vibe-secondary"] = "#e0f2fe",
            ["--vibe-secondary-foreground"] = "#075985",
            ["--vibe-accent"] = "#06b6d4",
            ["--vibe-border"] = "#bae6fd",
            ["--vibe-muted-foreground"] = "#64748b",
            ["--vibe-card"] = "#ffffff"
        },
        "forest" => new Dictionary<string, string>
        {
            ["--vibe-background"] = "#f0fdf4",
            ["--vibe-foreground"] = "#14532d",
            ["--vibe-primary"] = "#16a34a",
            ["--vibe-primary-foreground"] = "#ffffff",
            ["--vibe-secondary"] = "#dcfce7",
            ["--vibe-secondary-foreground"] = "#166534",
            ["--vibe-accent"] = "#22c55e",
            ["--vibe-border"] = "#bbf7d0",
            ["--vibe-muted-foreground"] = "#64748b",
            ["--vibe-card"] = "#ffffff"
        },
        "sunset" => new Dictionary<string, string>
        {
            ["--vibe-background"] = "#fff7ed",
            ["--vibe-foreground"] = "#7c2d12",
            ["--vibe-primary"] = "#ea580c",
            ["--vibe-primary-foreground"] = "#ffffff",
            ["--vibe-secondary"] = "#ffedd5",
            ["--vibe-secondary-foreground"] = "#9a3412",
            ["--vibe-accent"] = "#f97316",
            ["--vibe-border"] = "#fed7aa",
            ["--vibe-muted-foreground"] = "#64748b",
            ["--vibe-card"] = "#ffffff"
        },
        "purple" => new Dictionary<string, string>
        {
            ["--vibe-background"] = "#faf5ff",
            ["--vibe-foreground"] = "#581c87",
            ["--vibe-primary"] = "#9333ea",
            ["--vibe-primary-foreground"] = "#ffffff",
            ["--vibe-secondary"] = "#f3e8ff",
            ["--vibe-secondary-foreground"] = "#6b21a8",
            ["--vibe-accent"] = "#a855f7",
            ["--vibe-border"] = "#e9d5ff",
            ["--vibe-muted-foreground"] = "#64748b",
            ["--vibe-card"] = "#ffffff"
        },
        "midnight" => new Dictionary<string, string>
        {
            ["--vibe-background"] = "#0a0e27",
            ["--vibe-foreground"] = "#e2e8f0",
            ["--vibe-primary"] = "#4f46e5",
            ["--vibe-primary-foreground"] = "#ffffff",
            ["--vibe-secondary"] = "#1e293b",
            ["--vibe-secondary-foreground"] = "#cbd5e1",
            ["--vibe-accent"] = "#6366f1",
            ["--vibe-border"] = "#334155",
            ["--vibe-muted-foreground"] = "#94a3b8",
            ["--vibe-card"] = "#0f172a"
        },
        _ => null
    };
}
